{% extends 'base.html' %}
{% block title %}Session 2: Interactive Class List{% endblock %}

{% block content %}
<div class="container mt-4">
  <!-- Connection Status -->
  {% if connected %}
  <div class="alert alert-success">
    <i class="bi bi-check-circle-fill"></i> Connected to MongoDB cluster
  </div>
  {% else %}
  <div class="alert alert-danger">
    <i class="bi bi-exclamation-triangle-fill"></i> Not connected to MongoDB
  </div>
  {% endif %}

  <!-- Filters -->
  <div class="row mb-4">
    <div class="col-md-6">
      <form action="{{ url_for('session2_classlist.classlist_view') }}" method="get" id="filterForm">
        <div class="mb-3">
          <label for="semester" class="form-label">Semester:</label>
          <select class="form-select" name="semester" id="semester" onchange="this.form.submit()">
            <option value="">-- All Semesters --</option>
            {% for semester in semester_options %}
            <option value="{{ semester }}" {% if current_semester == semester %}selected{% endif %}>{{ semester }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3">
          <label for="subject" class="form-label">Subject Code:</label>
          <select class="form-select" name="subject" id="subject" onchange="this.form.submit()">
            <option value="">-- All Subjects --</option>
            {% for code, description in subject_options %}
            <option value="{{ code }}" {% if current_subject == code %}selected{% endif %}>{{ code }}</option>
            {% endfor %}
          </select>
        </div>
      </form>
    </div>
  </div>

  <!-- Class Overview -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="bi bi-clipboard-data"></i> Class Overview</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <table class="table table-borderless">
            <tr>
              <th>School Year:</th>
              <td>{{ school_year }}</td>
            </tr>
            <tr>
              <th>Subject Code:</th>
              <td>{{ subject_code }}</td>
            </tr>
            <tr>
              <th>Instructor:</th>
              <td>{{ instructor }}</td>
            </tr>
            <tr>
              <th>General Percentile Average (GPA):</th>
              <td>{{ stats.gpa }}</td>
            </tr>
            <tr>
              <th>Below GPA:</th>
              <td>{{ stats.below_gpa }}</td>
            </tr>
          </table>
        </div>
        <div class="col-md-6">
          <table class="table table-borderless">
            <tr>
              <th>Semester:</th>
              <td>{{ semester_name }}</td>
            </tr>
            <tr>
              <th>Subject:</th>
              <td>{{ subject }}</td>
            </tr>
            <tr>
              <th>Total Enrolled:</th>
              <td>{{ stats.total_enrolled }}</td>
            </tr>
            <tr>
              <th>Above GPA:</th>
              <td>{{ stats.above_gpa }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Student Table -->
  <div class="card">
    <div class="card-header bg-dark text-white">
      <h5 class="mb-0"><i class="bi bi-table"></i> Student Table</h5>
    </div>
    <div class="card-body">
      <!-- Loading indicator -->
      <div id="loading-indicator" class="text-center my-5" style="display: none;">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading student data... This may take a moment.</p>
      </div>

      <!-- Student data table -->
      <div id="data-table" class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-primary">
            <tr>
              <th>Student ID</th>
              <th>Name</th>
              <th>Course</th>
              <th>Year</th>
              <th>Subject</th>
              <th>Units</th>
              <th>Teacher</th>
              <th>Grade</th>
              <th>Semester</th>
              <th>School Year</th>
            </tr>
          </thead>
          <tbody>
            {% if data %}
            {% for student in data %}
            <tr>
              <td>{{ student.StudentID }}</td>
              <td>{{ student.FullName }}</td>
              <td>{{ student.Course }}</td>
              <td>{{ student.YearLevel }}</td>
              <td>{{ student.Subject }}</td>
              <td>{{ student.Units }}</td>
              <td>{{ student.Teacher }}</td>
              <td>{{ student.Grade }}</td>
              <td>{{ student.Semester }}</td>
              <td>{{ student.SchoolYear }}</td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
              <td colspan="10" class="text-center">No data available</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
      
      <!-- Pagination Controls -->
      <div class="d-flex justify-content-between align-items-center p-3 bg-light">
        <div class="text-muted">
          Showing {{ data|length }} of {{ page_size }} records per page
        </div>
        <nav aria-label="Page navigation">
          <ul class="pagination mb-0">
            <li class="page-item {% if not has_prev %}disabled{% endif %}">
              <a class="page-link" href="{{ url_for('session2_classlist.classlist_view', page=current_page-1, subject=current_subject, semester=current_semester) }}" aria-label="Previous">
                <span aria-hidden="true">&laquo; Previous</span>
              </a>
            </li>
            <li class="page-item active">
              <span class="page-link">Page {{ current_page + 1 }}</span>
            </li>
            <li class="page-item {% if not has_next %}disabled{% endif %}">
              <a class="page-link" href="{{ url_for('session2_classlist.classlist_view', page=current_page+1, subject=current_subject, semester=current_semester) }}" aria-label="Next">
                <span aria-hidden="true">Next &raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>
{% endblock %}
